# Document generation example: creates synthetic docs and indexes to Elasticsearch.

connectors: [
  {
    # Generates N empty docs with only an ID. Stages fill in fields.
    class: "com.kmwllc.lucille.connector.SequenceConnector"
    name: "connector1"
    pipeline: "pipeline1"
    numDocs: 100
    numDocs: ${?NUM_DOCS}
  }
]

pipelines: [
  {
    name: "pipeline1"
    stages: [

      # Random text
      {
        # Uses AddRandomString to build a long, space-joined text field from a local term file.
        name: "test_text"
        class: "com.kmwllc.lucille.stage.AddRandomString"
        fieldName: "text_example"
        inputDataPath: "resources/example-dictionary.txt"
        minNumOfTerms: 10
        maxNumOfTerms: 200
        concatenate: true   # join terms into a single string
      },

      # Random numbers
      {
        name: "test_integer"
        class: "com.kmwllc.lucille.stage.AddRandomInt"
        fieldName: "integer_example"
        rangeStart: 0
        rangeEnd: 100000
      },
      {
        name: "test_double"
        class: "com.kmwllc.lucille.stage.AddRandomDouble"
        fieldName: "double_example"
        rangeStart: 10.3
        rangeEnd: 534.8
      },

      # Random boolean
      {
        name: "test_boolean"
        class: "com.kmwllc.lucille.stage.AddRandomBoolean"
        fieldName: "boolean_example"
        percentTrue: 60   # 60% true, 40% false
      },

      # Random date
      {
        name: "test_date"
        class: "com.kmwllc.lucille.stage.AddRandomDate"
        fieldName: "date_example"
        rangeStartDate: "2015-07-31"   # yyyy-MM-dd
        rangeEndDate:   "2025-07-31"   # yyyy-MM-dd
      },

      # Random nested structure
      {
        # Builds an array of objects at nested_example, each with field_a/b/c.
        # Values come from a local generator (stringGen) using your terms.
        name: "test_nested"
        class: "com.kmwllc.lucille.stage.AddRandomNestedField"
        targetField: "nested_example"
        minNumObjects: 1
        maxNumObjects: 20

        # Map "destination path in each object" -> "source field or generator key".
        entries: {
          "field_a" = "stringGen"
          "field_b" = "stringGen"
          "field_c" = "stringGen"
        }

        # Generators only run when the source field is missing. Here we always rely on the generator.
        generators: {
          stringGen = {
            class: "com.kmwllc.lucille.stage.AddRandomString"
            input_data_path: "resources/example-dictionary.txt"
            minNumOfTerms: 1
            maxNumOfTerms: 5
            concatenate: true
          }
        }
      }
    ]
  }
]

# Indexer
# By default, this targets Elasticsearch. Turn off sending by changing sendEnabled to false.
indexer {
  type: "Elasticsearch"
  batchSize: 1000
  batchTimeout: 1000
  logRate: 1000
  sendEnabled: true
  sendEnabled: ${?ES_SEND_ENABLED}
}

elasticsearch {
  url:   "http://localhost:9200"
  url:   ${?ES_URL}
  index: "test_docs"
  index: ${?ES_INDEX}
  acceptInvalidCert: true
}