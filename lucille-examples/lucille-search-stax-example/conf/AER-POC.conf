# this example illustrates how Lucille can handle a simple use case like indexing the contents of a CSV file into Solr

connectors: [
  {
    class: "com.kmwllc.lucille.connector.CSVConnector",
    path: "data/AER_data.csv",
    name: "connector1",
    pipeline: "pipeline1"
  }
]

pipelines: [
  {
    name: "pipeline1",
    stages: [
      {
        name = "Extract PNOAs from HTML"
        class = "com.kmwllc.lucille.stage.ApplyJSoup"
        filePathField = "filename"
        conditions: [
          {
            fields: [
              "ss_recordType"
            ]
            values: [
              "PNOA"
            ]
          }
        ]
        destinationFields: {
          ss_authorization_request_number: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_REQUEST_NUMBER"]""",
            attribute: "value"
          },
          ss_primary_applicant_name: {
            type: "attribute",
            selector: """input[name="PRIMARY_APPLICANT_NAME"]""",
            attribute: "value"
          },
          tcngramm_X3b_en_body: {
            type: "attribute",
            selector: """input[name="PUBLIC_NOTICE_DESCRIPTION"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_name: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_NAME"]""",
            attribute: "value"
          },
          ss_primary_applicant_address1: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ADDRESS1"]""",
            attribute: "value"
          },
          ss_primary_applicant_address2: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ADDRESS2"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_city: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_CITY"]""",
            attribute: "value"
          },
          ss_primary_applicant_province_state: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_PROVINCE_STATE"]""",
            attribute: "value"
          },
          ss_primary_applicant_zip_code: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ZIP_CODE"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_phone: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_PHONE"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_email: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_EMAIL"]""",
            attribute: "value"
          },
          soc_due_date: {
            type: "attribute",
            selector: """input[name="SOC_DUE_DATE"]""",
            attribute: "value"
          },
          timestamp: {
            type: "attribute",
            selector: """input[name="NOTICE_ISSUE_DATE"]""",
            attribute: "value"
          },
          ss_authorization_group: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION GROUP"]""",
            attribute: "value"
          },
          pnoa_expiry_date: {
            type: "attribute",
            selector: """input[name="PNOA_Expiry_date"]""",
            attribute: "value"
          },
          ss_authorization_location: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_LOCATION"]""",
            attribute: "value"
          },
        }
      },
      {
        name = "Create PNOA URLs"
        class = "com.kmwllc.lucille.stage.Concatenate"
        dest: "ss_type"
        format_string: "https://webapps.aer.ca/pnoa/details?applicationnumber={AUTHORIZATION_REQUEST_NUMBER}"
        conditions: [
          {
            fields: [
              "ss_recordType"
            ]
            values: [
              "PNOA"
            ]
          }
        ]
      },
      {
        name = "Extract PODs from HTML"
        class = "com.kmwllc.lucille.stage.ApplyJSoup"
        filePathField = "filename"
        conditions: [
          {
            fields: [
              "ss_recordType"
            ]
            values: [
              "POD"
            ]
          }
        ]
        destinationFields: {
          ss_authorization_request_number: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_REQUEST_NUMBER"]""",
            attribute: "value"
          },
          ss_primary_applicant_name: {
            type: "attribute",
            selector: """input[name="PRIMARY_APPLICANT_NAME"]""",
            attribute: "value"
          },
          tcngramm_X3b_en_body: {
            type: "attribute",
            selector: """input[name="PUBLIC_NOTICE_DESCRIPTION"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_name: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_NAME"]""",
            attribute: "value"
          },
          ss_primary_applicant_address1: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ADDRESS1"]""",
            attribute: "value"
          },
          ss_primary_applicant_address2: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ADDRESS2"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_city: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_CITY"]""",
            attribute: "value"
          },
          ss_primary_applicant_province_state: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_PROVINCE_STATE"]""",
            attribute: "value"
          },
          ss_primary_applicant_zip_code: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_ZIP_CODE"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_phone: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_PHONE"]""",
            attribute: "value"
          },
          ss_primary_applicant_contact_email: {
            type: "attribute",
            selector: """input[name="PRIM_APPLICANT_CONTACT_EMAIL"]""",
            attribute: "value"
          },
          soc_due_date: {
            type: "attribute",
            selector: """input[name="SOC_DUE_DATE"]""",
            attribute: "value"
          },
          timestamp: {
            type: "attribute",
            selector: """input[name="NOTICE_ISSUE_DATE"]""",
            attribute: "value"
          },
          ss_authorization_group: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION GROUP"]""",
            attribute: "value"
          },
          pnoa_expiry_date: {
            type: "attribute",
            selector: """input[name="PNOA_Expiry_date"]""",
            attribute: "value"
          },
          ss_authorization_location: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_LOCATION"]""",
            attribute: "value"
          },
          ss_authorization_decision: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_DECISION"]""",
            attribute: "value"
          },
          authorization_decision_date: {
            type: "attribute",
            selector: """input[name="AUTHORIZATION_DECISION_DATE"]""",
            attribute: "value"
          },
        }
      },
      {
        name = "Create POD URLs"
        class = "com.kmwllc.lucille.stage.Concatenate"
        dest: "ss_type"
        format_string: "https://webapps.aer.ca/pod/details?decisionnumber={ss_authorization_request_number}"
        conditions: [
          {
            fields: [
              "ss_recordType"
            ]
            values: [
              "POD"
            ]
          }
        ]
      },
      {
        name = "Create Titles for all documents"
        class = "com.kmwllc.lucille.stage.Concatenate"
        dest: "ss_title"
        format_string: "{ss_authorization_request_number} - {ss_primary_applicant_name}"
      },
      {
        name = "Format Date Strings"
        class = "com.kmwllc.lucille.stage.ParseDate"
        source = ["pnoa_expiry_date", "soc_due_date", "authorization_decision_date", "timestamp"]
        dest = ["ds_pnoa_expiry_date", "ds_soc_due_date", "ds_authorization_decision_date", "timestamp"]
        format_strs = ["yyyy-MM-dd HH:mm:ss."]
        time_zone_id = "Universal"
      }
    ]
  }
]

indexer {
  type: "SearchStax"
  url: "https://ss136343-p59xfuqj-canadacentral-azure.searchstax.com/solr"
  defaultCollection: "dev-792"
  userName: "app792-admin"
  password: "rrSBvZGRiaFch7A!"
}
